<!DOCTYPE html>
<html lang="zh-Hans">

<head>
    <meta charset="UTF-8">
    <title>我的导航</title>
    <link rel="stylesheet" href="./style.css">
</head>

<body>
    <header></header>
    <main>
        <div class="wrapper" id="keyboard">

        </div>
    </main>
    <footer></footer>
    <script>
        // 1.初始化数据
        var hashA = init();
        var keys = hashA['keys'];
        var hash = hashA['hash'];


        // 2.生成键盘
        // 遍历keys，生成kbd标签       
        generateKeyboard(keys, hash);

        // 3.监听键盘
        listenToUser(hash);


        //下面是工具函数
        function init() {
            var keys = {
                0: ['q', 'w', 'e', 'r', 't', 'y', 'u', 'i', 'o', 'p'],
                1: ['a', 's', 'd', 'f', 'g', 'h', 'j', 'k', 'l'],
                2: ['z', 'x', 'c', 'v', 'b', 'n', 'm'],
                length: 3
            }
            var hash = {
                'q': 'www.qq.com', 'w': 'weibo.com', 'e': 'ele.me', 'r': 'www.renren.com', 't': 'tianya.cn', 'y': 'www.youku.com',
                'u': 'uc.cn', 'i': 'iqiyi.com', 'o': 'opera.com', 'a': 'acfun.cn', 's': 'souhu.com',
                'z': 'zhihu.com', 'b': 'baidu.com',
            }
            var hashInLocalStorage = getFromLocalStorage('zzz')   // 取出locaStorage中的zzz对应的hash
            if (hashInLocalStorage) {     // 如果hashInLocalStorage存在则执行下面的
                hash = hashInLocalStorage;
            }
            return {
                "keys": keys,
                "hash": hash
            }

        }
        function getFromLocalStorage(name) {
            return JSON.parse(localStorage.getItem(name) || 'null');
        }
        function generateKeyboard(keys, hash) {
            for (var index = 0; index < keys['length']; index = index + 1) {             // 0 1 2
                var div1 = tag('div', { className: 'row' });
                keyboard.appendChild(div1);
                var row = keys[index];
                for (var index2 = 0; index2 < row['length']; index2 = index2 + 1) {
                    var span = tag('span', { textContent: row[index2], className: 'text' });

                    var button1 = createButton(row[index2]);

                    var img1 = createIamge(hash[row[index2]]);

                    var kbd1 = tag('kbd', { className: 'key' });
                    div1.appendChild(kbd1);
                    kbd1.appendChild(span);
                    kbd1.appendChild(img1);
                    kbd1.appendChild(button1);
                }
            }
        }
        function tag(tagName, attributes) {   // 声明一个函数tag(创建一个标签，给他一个hash)与下面的tag('div', {className: 'row'})对应
            var element = document.createElement(tagName);    // 先根据要求创建一个标签(如div)
            for (var key in attributes) {      // key为className,id,textContent，用for循环遍历hash
                element[key] = attributes[key];     // 将attributes这个hash中的内容赋值给element
            }
            return element;     // 返回element
        }
        function createButton(id) {
            var button1 = tag('button', { textContent: 'E', id: id });
            button1.onclick = function (skr) {
                var button2 = skr.target;
                var img2 = button2.previousSibling;
                var key = button2.id;
                var x = prompt('请输入网址');
                hash[key] = x;
                img2.src = 'http://' + x + '/favicon.ico';
                img2.onerror = function (xxx) {
                    xxx.target.src = '//i.loli.net/2019/10/14/McmNCXrzpIEKS2F.png';
                }
                localStorage.setItem('zzz', JSON.stringify(hash));
            }
            return button1;
        }
        function createIamge(domain) {
            var img1 = tag('img');
            if (domain) {
                img1.src = 'http://' + domain + '/favicon.ico';
            } else {
                img1.src = '//i.loli.net/2019/10/14/McmNCXrzpIEKS2F.png';
            }
            img1.onerror = function (xxx) {
                xxx.target.src = '//i.loli.net/2019/10/14/McmNCXrzpIEKS2F.png';
            }
            return img1;
        }
        function listenToUser(hash) {
            document.onkeypress = function (skr) {
                var key = skr.key;
                var website = hash[key];
                window.open('http://' + website, '_blank');
            }
        }
    </script>
</body>

</html>